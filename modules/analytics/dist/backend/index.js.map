{"version":3,"sources":["index.ts"],"names":["onServerStarted","bp","onServerReady","db","AnalyticsDatabase","database","job","AnalyticsService","initialize","process","BOTPRESS_EVENTS","on","arg","addMetric","start","entryPoint","definition","name","menuIcon","menuText","noInterface","fullName","homepage"],"mappings":";;;;;;;AAEA;;AACA;;AACA;;;;AAEA,MAAMA,eAAe,GAAG,MAAOC,EAAP,IAA0B,CAAE,CAApD;;AACA,MAAMC,aAAa,GAAG,MAAOD,EAAP,IAA0B;AAC9C,QAAME,EAAE,GAAG,IAAIC,qBAAJ,CAAsBH,EAAE,CAACI,QAAzB,CAAX;AACA,oBAAaF,EAAb;AACA,QAAMG,GAAG,GAAG,IAAIC,YAAJ,CAAqBN,EAArB,EAAyBE,EAAzB,CAAZ;AACA,QAAMG,GAAG,CAACE,UAAJ,EAAN;AAEAC,EAAAA,OAAO,CAACC,eAAR,CAAwBC,EAAxB,CAA2B,gBAA3B,EAA6C,MAAOC,GAAP,IAAmDN,GAAG,CAACO,SAAJ,CAAcD,GAAd,CAAhG;AAEAN,EAAAA,GAAG,CAACQ,KAAJ;AACD,CATD;;AAWA,MAAMC,UAAgC,GAAG;AACvCf,EAAAA,eADuC;AAEvCE,EAAAA,aAFuC;AAGvCc,EAAAA,UAAU,EAAE;AACVC,IAAAA,IAAI,EAAE,WADI;AAEVC,IAAAA,QAAQ,EAAE,UAFA;AAGVC,IAAAA,QAAQ,EAAE,WAHA;AAIVC,IAAAA,WAAW,EAAE,KAJH;AAKVC,IAAAA,QAAQ,EAAE,WALA;AAMVC,IAAAA,QAAQ,EAAE;AANA;AAH2B,CAAzC;eAaeP,U","sourceRoot":"/Users/renaud/Code/Botpress/botpress/modules/analytics/src/backend","sourcesContent":["import * as sdk from 'botpress/sdk'\n\nimport AnalyticsApi from './api'\nimport { AnalyticsDatabase } from './db'\nimport AnalyticsService from './job'\n\nconst onServerStarted = async (bp: typeof sdk) => {}\nconst onServerReady = async (bp: typeof sdk) => {\n  const db = new AnalyticsDatabase(bp.database)\n  AnalyticsApi(db)\n  const job = new AnalyticsService(bp, db)\n  await job.initialize()\n\n  process.BOTPRESS_EVENTS.on('core.analytics', async (arg: { botId; channel; metric; method }) => job.addMetric(arg))\n\n  job.start()\n}\n\nconst entryPoint: sdk.ModuleEntryPoint = {\n  onServerStarted,\n  onServerReady,\n  definition: {\n    name: 'analytics',\n    menuIcon: 'timeline',\n    menuText: 'Analytics',\n    noInterface: false,\n    fullName: 'Analytics',\n    homepage: 'https://botpress.com'\n  }\n}\n\nexport default entryPoint\n"]}